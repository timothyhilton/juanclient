package juan.modules.render;

import net.minecraft.client.Minecraft;
import net.minecraft.client.gui.FontRenderer;
import net.minecraft.client.gui.ScaledResolution;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.item.Item;
import net.minecraft.item.ItemStack;
import org.lwjgl.input.Keyboard;

import juan.events.Event;
import juan.events.listeners.EventRenderGUI;
import juan.events.listeners.EventUpdate;
import juan.modules.Module;

import java.awt.Color;
import java.util.HashMap;
import java.util.Map;

public class BedwarsItemCounter extends Module {
    private final Map<String, Integer> itemCounts = new HashMap<>();
    private final String[] bedwarsItems = {"iron_ingot", "gold_ingot", "diamond", "emerald"};

    public BedwarsItemCounter() {
        super("BedwarsItemCounter", Keyboard.KEY_NONE, Category.RENDER, true);
    }

    @Override
    public void onEnable() {
        // Initialize counts
        for (String item : bedwarsItems) {
            itemCounts.put(item, 0);
        }
    }

    @Override
    public void onDisable() {
        // Clear counts
        itemCounts.clear();
    }

    @Override
    public void onEvent(Event e) {
        if (e instanceof EventRenderGUI) {
	    	updateItemCounts();
	        renderItemCounts((EventRenderGUI) e);
        }
    }

    private void updateItemCounts() {
        EntityPlayer player = Minecraft.getMinecraft().thePlayer;
        if (player == null) return;

        for (String itemName : bedwarsItems) {
            int count = 0;
            for (ItemStack stack : player.inventory.mainInventory) {
                if (stack != null && stack.getItem().getUnlocalizedName().contains(itemName)) {
                    count += stack.stackSize;
                }
            }
            itemCounts.put(itemName, count);
        }
    }

    private void renderItemCounts(EventRenderGUI event) {
        ScaledResolution scaledResolution = new ScaledResolution(Minecraft.getMinecraft());
        FontRenderer fontRenderer = Minecraft.getMinecraft().fontRendererObj;
        int screenWidth = scaledResolution.getScaledWidth();
        int screenHeight = scaledResolution.getScaledHeight();

        int y = screenHeight - 10;
        for (String itemName : bedwarsItems) {
            String display = itemName.replace("_ingot", "").toUpperCase() + ": " + itemCounts.get(itemName);
            int x = screenWidth - fontRenderer.getStringWidth(display) - 5;
            fontRenderer.drawStringWithShadow(display, x, y, Color.WHITE.getRGB());
            y -= 10;
        }
    }
}